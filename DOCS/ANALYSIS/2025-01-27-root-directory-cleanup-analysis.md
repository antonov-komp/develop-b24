# Анализ корневой директории APP-B24/

**Дата создания:** 2025-01-27 16:00 (UTC+3, Брест)  
**Автор:** Технический писатель  
**Статус:** Завершён

## Цель анализа

Проверить соответствие корневой директории `APP-B24/` требованиям архитектуры проекта, где в корне должны быть только:
- Два основных PHP-файла: `index.php` и `install.php`
- Конфигурационные JSON-файлы
- Служебные файлы (`.gitignore`, `.htaccess`, `README.md`)

## Текущее состояние

### ✅ Файлы, которые должны остаться в корне (9 файлов):

1. **`index.php`** — главная страница приложения
   - Статус: ✓ Корректно размещён
   - Использование: Точка входа для главной страницы

2. **`install.php`** — страница установки
   - Статус: ✓ Корректно размещён
   - Использование: Точка входа для установки приложения

3. **`composer.json`** — конфигурация Composer
   - Статус: ✓ Корректно размещён
   - Использование: Управление зависимостями PHP

4. **`config.json`** — конфигурация приложения
   - Статус: ✓ Корректно размещён
   - Использование: Настройки приложения

5. **`settings.json`** — настройки Bitrix24
   - Статус: ✓ Корректно размещён
   - Использование: Токены и настройки Bitrix24

6. **`access-config.json`** — конфигурация доступа
   - Статус: ✓ Корректно размещён
   - Использование: Настройки прав доступа

7. **`.gitignore`** — правила Git
   - Статус: ✓ Корректно размещён
   - Использование: Исключение файлов из Git

8. **`.htaccess`** — конфигурация Apache
   - Статус: ✓ Корректно размещён
   - Использование: Настройки веб-сервера

9. **`README.md`** — документация проекта
   - Статус: ✓ Корректно размещён
   - Использование: Описание проекта

### ⚠️ Файлы, которые используются, но должны быть перемещены (4 файла):

#### 1. `failure.php` — страница ошибки доступа

**Текущее расположение:** `/APP-B24/failure.php`  
**Рекомендуемое расположение:** `/APP-B24/public/failure.php`

**Использование:**
- Используется в `src/Services/AuthService.php` (строка 287-293)
- Редирект при ошибках авторизации Bitrix24

**Рекомендация:**
- Переместить в `public/failure.php` (публичная страница ошибки)
- Обновить путь в `AuthService.php::redirectToFailure()`

**Код для обновления:**
```php
// src/Services/AuthService.php, строка ~287
// Было:
$failurePath = $scriptPath . '/failure.php';

// Должно быть:
$failurePath = $scriptPath . '/public/failure.php';
```

---

#### 2. `access-control.php` — страница управления правами доступа

**Текущее расположение:** `/APP-B24/access-control.php`  
**Рекомендуемое расположение:** Оставить в корне (точка входа) или `/APP-B24/public/access-control.php`

**Использование:**
- Точка входа для маршрута `/access-control`
- Загружает Vue.js приложение через `loadVueApp('/access-control')`
- Упоминается в `README.md` и `frontend/INTEGRATION.md`

**Рекомендация:**
- **Вариант 1:** Оставить в корне (если это точка входа, аналогично `index.php`)
- **Вариант 2:** Переместить в `public/access-control.php` и настроить маршрутизацию в `.htaccess`

**Решение:** Оставить в корне, так как это точка входа приложения (аналогично `index.php`)

---

#### 3. `token-analysis.php` — страница анализа токена

**Текущее расположение:** `/APP-B24/token-analysis.php`  
**Рекомендуемое расположение:** Оставить в корне (точка входа) или `/APP-B24/public/token-analysis.php`

**Использование:**
- Точка входа для маршрута `/token-analysis`
- Загружает Vue.js приложение через `loadVueApp('/token-analysis')`
- Упоминается в `README.md` и `frontend/INTEGRATION.md`
- Используется в `api/index.php` (строка 76)

**Рекомендация:**
- **Вариант 1:** Оставить в корне (если это точка входа, аналогично `index.php`)
- **Вариант 2:** Переместить в `public/token-analysis.php` и настроить маршрутизацию в `.htaccess`

**Решение:** Оставить в корне, так как это точка входа приложения (аналогично `index.php`)

---

#### 4. `config-error.php` — страница ошибки при деактивации интерфейса

**Текущее расположение:** `/APP-B24/config-error.php`  
**Рекомендуемое расположение:** `/APP-B24/templates/config-error.php` или `/APP-B24/public/config-error.php`

**Использование:**
- ❌ **НЕ используется в коде** (проверено через grep)
- Создан для задачи TASK-004, но не интегрирован
- Предназначен для отображения ошибки при отключении интерфейса через `config.json`

**Рекомендация:**
- Переместить в `templates/config-error.php` (шаблон ошибки)
- Или удалить, если функционал не реализован

**Решение:** Переместить в `templates/config-error.php` для будущего использования

---

### ❌ Файлы, которые должны быть удалены или перемещены в `tools/` (4 файла):

#### 1. `test-bitrix24-api.php` — тестовый файл для проверки API Bitrix24

**Текущее расположение:** `/APP-B24/test-bitrix24-api.php`  
**Рекомендуемое расположение:** `/APP-B24/tools/test-bitrix24-api.php` или удалить

**Использование:**
- Тестовый скрипт для проверки работы API Bitrix24
- Используется вручную: `php test-bitrix24-api.php AUTH_ID DOMAIN`
- Не используется в основном коде

**Рекомендация:** Переместить в `tools/test-bitrix24-api.php`

---

#### 2. `test-api.php` — тестовый файл для проверки API

**Текущее расположение:** `/APP-B24/test-api.php`  
**Рекомендуемое расположение:** `/APP-B24/tools/test-api.php` или удалить

**Использование:**
- Тестовый скрипт для проверки работы API
- Используется вручную: `test-api.php?AUTH_ID=...&DOMAIN=...`
- Не используется в основном коде

**Рекомендация:** Переместить в `tools/test-api.php`

---

#### 3. `test-autoload.php` — тестовый файл для проверки автозагрузки

**Текущее расположение:** `/APP-B24/test-autoload.php`  
**Рекомендуемое расположение:** `/APP-B24/tools/test-autoload.php` или удалить

**Использование:**
- Тестовый скрипт для проверки автозагрузки классов
- Не используется в основном коде

**Рекомендация:** Переместить в `tools/test-autoload.php`

---

#### 4. `test-migration.php` — тестовый файл для проверки миграций

**Текущее расположение:** `/APP-B24/test-migration.php`  
**Рекомендуемое расположение:** `/APP-B24/tools/test-migration.php` или удалить

**Использование:**
- Тестовый скрипт для проверки миграций БД
- Не используется в основном коде

**Рекомендация:** Переместить в `tools/test-migration.php`

---

## Итоговые рекомендации

### Действия для очистки корня:

1. **Переместить `failure.php` в `public/failure.php`:**
   ```bash
   mv APP-B24/failure.php APP-B24/public/failure.php
   ```
   - Обновить путь в `src/Services/AuthService.php`

2. **Переместить `config-error.php` в `templates/config-error.php`:**
   ```bash
   mv APP-B24/config-error.php APP-B24/templates/config-error.php
   ```

3. **Переместить все тестовые файлы в `tools/`:**
   ```bash
   mv APP-B24/test-*.php APP-B24/tools/
   ```

4. **Оставить в корне точки входа:**
   - `index.php` ✓
   - `install.php` ✓
   - `access-control.php` ✓ (точка входа)
   - `token-analysis.php` ✓ (точка входа)

### Итоговая структура корня APP-B24/:

```
APP-B24/
├── index.php                    # Главная страница ✓
├── install.php                  # Страница установки ✓
├── access-control.php           # Управление правами доступа ✓
├── token-analysis.php           # Анализ токена ✓
├── composer.json                # Конфигурация Composer ✓
├── config.json                  # Конфигурация приложения ✓
├── settings.json                # Настройки Bitrix24 ✓
├── access-config.json           # Конфигурация доступа ✓
├── .gitignore                   # Правила Git ✓
├── .htaccess                    # Конфигурация Apache ✓
├── README.md                    # Документация ✓
├── composer.lock                # Lock-файл Composer ✓
└── [директории: src/, public/, tools/, templates/, etc.]
```

### Файлы, которые будут перемещены:

- `public/failure.php` (из корня)
- `templates/config-error.php` (из корня)
- `tools/test-bitrix24-api.php` (из корня)
- `tools/test-api.php` (из корня)
- `tools/test-autoload.php` (из корня)
- `tools/test-migration.php` (из корня)

## Следующие шаги

1. Создать задачу TASK-XXX для выполнения очистки
2. Выполнить перемещение файлов
3. Обновить все ссылки на перемещённые файлы
4. Протестировать работоспособность приложения
5. Обновить документацию

## История правок

- 2025-01-27 16:00 (UTC+3, Брест): Создан анализ


