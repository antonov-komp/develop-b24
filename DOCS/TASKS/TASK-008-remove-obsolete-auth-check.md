# TASK-008: Удаление устаревшего файла auth-check.php

**Дата создания:** 2025-12-20 23:15 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Средний  
**Исполнитель:** Bitrix24 Программист (Vanilla JS)

---

## Описание

Удалить устаревший файл `auth-check.php`, так как он использовался только в `install.php` для обратной совместимости. После рефакторинга `install.php` (TASK-007) файл больше не нужен.

---

## Контекст

Файл `auth-check.php` был создан как обертка для обратной совместимости при переходе на новую архитектуру. Он содержит функции-обертки над `AuthService`:
- `checkBitrix24Auth()` — обертка над `AuthService::checkBitrix24Auth()`
- `redirectToFailure()` — обертка над `AuthService::redirectToFailure()`

После рефакторинга `install.php` (TASK-007) файл больше не используется и должен быть удален.

**Ссылка на анализ:** `DOCS/ANALYSIS/2025-12-20-file-structure-analysis.md`

---

## Модули и компоненты

**Удаляемые файлы:**
- `APP-B24/auth-check.php` — устаревший файл с функциями-обертками

**Проверяемые файлы (на использование):**
- `APP-B24/install.php` — должен использовать `AuthService` напрямую (после TASK-007)
- Все файлы в `APP-B24/src/`

---

## Зависимости

**От каких задач зависит:**
- **TASK-007:** Рефакторинг install.php для использования AuthService (должна быть завершена)

**Какие задачи зависят от этой:**
- Нет

**Связь с другими задачами:**
- Связана с общим рефакторингом (этапы 1-5 завершены)

---

## Ступенчатые подзадачи

1. **Проверка завершения TASK-007:**
   - Убедиться, что TASK-007 завершена
   - Проверить, что `install.php` использует `AuthService` напрямую
   - Убедиться, что `install.php` не использует `auth-check.php`

2. **Проверка использования файла:**
   - Выполнить поиск по всему проекту: `grep -r "auth-check" APP-B24/`
   - Проверить все `require_once` и `include` в проекте
   - Убедиться, что файл нигде не используется

3. **Проверка функциональности:**
   - Убедиться, что все функции из `auth-check.php` реализованы в `AuthService`
   - Проверить, что нет прямых вызовов функций из этого файла

4. **Удаление файла:**
   - Удалить `APP-B24/auth-check.php`
   - Проверить, что проект работает без этого файла

5. **Обновление документации:**
   - Обновить `APP-B24/README.md` (если там упоминается этот файл)
   - Обновить анализ в `DOCS/ANALYSIS/2025-12-20-file-structure-analysis.md`

---

## Технические требования

- **Проверка использования:** Обязательно проверить, что файл нигде не используется
- **Зависимость от TASK-007:** Задача должна быть выполнена только после завершения TASK-007
- **Безопасность:** Убедиться, что удаление не сломает функциональность

---

## Критерии приёмки

- [ ] TASK-007 завершена (install.php использует AuthService напрямую)
- [ ] Файл `auth-check.php` удален
- [ ] Проверено, что файл нигде не используется (grep не находит упоминаний)
- [ ] Все функции из файла реализованы в `AuthService`
- [ ] Приложение работает корректно после удаления
- [ ] Все страницы открываются без ошибок:
  - [ ] `index.php` работает
  - [ ] `install.php` работает (использует AuthService напрямую)
  - [ ] `access-control.php` работает
  - [ ] `token-analysis.php` работает
- [ ] Документация обновлена (если требуется)

---

## Тестирование

1. **Проверка поиска:**
   ```bash
   cd /var/www/backend.antonov-mark.ru/APP-B24
   grep -r "auth-check" .
   # Должно вернуть пустой результат (кроме этого файла задачи)
   ```

2. **Проверка функциональности:**
   - Открыть `index.php` в Bitrix24 — должна работать главная страница
   - Открыть `install.php` в Bitrix24 — должна работать установка (используя AuthService)
   - Открыть `access-control.php` в Bitrix24 — должно работать управление правами
   - Открыть `token-analysis.php` в Bitrix24 — должен работать анализ токена

3. **Проверка логов:**
   - Проверить логи на наличие ошибок после удаления файла
   - Убедиться, что нет ошибок типа "file not found"

---

## Риски и митигация

**Риск:** Файл может использоваться в каком-то месте, которое не было проверено.

**Митигация:**
- Тщательная проверка всех файлов проекта
- Выполнение задачи только после завершения TASK-007
- Тестирование всех страниц после удаления

**Риск:** Удаление файла может сломать функциональность, если TASK-007 не завершена полностью.

**Митигация:**
- Обязательная проверка завершения TASK-007 перед началом работы
- Проверка, что `install.php` не использует `auth-check.php`

---

## История правок

- 2025-12-20 23:15 (UTC+3, Брест): Создана задача на основе анализа структуры файлов

---

**Связанные документы:**
- `DOCS/ANALYSIS/2025-12-20-file-structure-analysis.md` — анализ структуры файлов
- `DOCS/TASKS/TASK-007-refactor-install-php.md` — рефакторинг install.php
- `APP-B24/src/Services/AuthService.php` — сервис авторизации

