# TASK-001: Установка и настройка b24phpsdk

**Дата создания:** 2025-12-20 19:48 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Критический  
**Исполнитель:** Bitrix24 Программист (Vanilla JS)

---

## Описание

Установка официального Bitrix24 PHP SDK (b24phpsdk) через Composer и настройка автозагрузки. Это первый этап миграции с CRest на b24phpsdk.

---

## Контекст

**Часть задачи:** TASK-000 (Миграция CRest → b24phpsdk)  
**Зависит от:** Нет (первая задача)  
**Зависимости от этой задачи:** TASK-002, TASK-003, TASK-004, TASK-005

**Цель:** Подготовить окружение для использования b24phpsdk вместо CRest.

---

## Модули и компоненты

**Создаваемые файлы:**
- `APP-B24/composer.json` — конфигурация Composer
- `APP-B24/composer.lock` — файл блокировки зависимостей (автоматически)
- `APP-B24/vendor/` — установленные зависимости (автоматически)

**Обновляемые файлы:**
- `APP-B24/src/bootstrap.php` — добавление автозагрузки Composer

---

## Зависимости

**От каких задач зависит:**
- Нет (первая задача в цепочке)

**Какие задачи зависят от этой:**
- TASK-002 (Создание Bitrix24SdkClient)
- TASK-003 (Обновление Bitrix24ApiService)
- TASK-004 (Миграция установки)
- TASK-005 (Обновление bootstrap)

---

## Ступенчатые подзадачи

### 1. Проверка наличия Composer

1. **Проверить установлен ли Composer:**
   ```bash
   composer --version
   ```

2. **Если не установлен — установить:**
   ```bash
   # Следовать инструкциям: https://getcomposer.org/download/
   ```

### 2. Создание composer.json

1. **Создать файл `APP-B24/composer.json`:**
   ```json
   {
       "name": "bitrix24/rest-app",
       "description": "REST приложение Bitrix24",
       "type": "project",
       "require": {
           "php": ">=8.4",
           "bitrix24/b24phpsdk": "^1.0"
       },
       "autoload": {
           "psr-4": {
               "App\\": "src/"
           }
       }
   }
   ```

2. **Проверить синтаксис JSON:**
   ```bash
   composer validate
   ```

### 3. Установка b24phpsdk

1. **Установить зависимости:**
   ```bash
   cd APP-B24
   composer install
   ```

2. **Проверить установку:**
   ```bash
   composer show bitrix24/b24phpsdk
   ```

3. **Проверить создание vendor/autoload.php:**
   ```bash
   ls -la vendor/autoload.php
   ```

### 4. Настройка автозагрузки

1. **Открыть `APP-B24/src/bootstrap.php`**

2. **Добавить в начало файла (после открывающего тега PHP):**
   ```php
   // Автозагрузка Composer
   require_once(__DIR__ . '/../vendor/autoload.php');
   ```

3. **Проверить, что автозагрузка не конфликтует с существующим кодом**

### 5. Проверка загрузки классов

1. **Создать тестовый скрипт:**
   ```php
   <?php
   require_once(__DIR__ . '/src/bootstrap.php');
   
   // Проверка загрузки классов SDK
   if (class_exists('Bitrix24\SDK\Core\ApiClient')) {
       echo "✓ SDK классы загружены успешно\n";
   } else {
       echo "✗ Ошибка загрузки SDK классов\n";
       exit(1);
   }
   
   // Проверка загрузки классов приложения
   if (class_exists('App\Services\LoggerService')) {
       echo "✓ Классы приложения загружены успешно\n";
   } else {
       echo "✗ Ошибка загрузки классов приложения\n";
       exit(1);
   }
   ```

2. **Запустить тест:**
   ```bash
   php APP-B24/test-autoload.php
   ```

---

## Технические требования

- **PHP:** 8.4+
- **Composer:** Последняя стабильная версия
- **b24phpsdk:** Версия ^1.0 (или последняя стабильная)
- **Автозагрузка:** PSR-4 стандарт

---

## Критерии приёмки

- [ ] Composer установлен и работает
- [ ] Файл `composer.json` создан с правильной конфигурацией
- [ ] b24phpsdk установлен через `composer install`
- [ ] Файл `vendor/autoload.php` существует
- [ ] Автозагрузка добавлена в `bootstrap.php`
- [ ] Тестовый скрипт подтверждает загрузку классов SDK
- [ ] Тестовый скрипт подтверждает загрузку классов приложения
- [ ] Нет конфликтов с существующим кодом

---

## Тестирование

### 1. Проверка установки Composer
```bash
composer --version
# Должна быть выведена версия Composer
```

### 2. Проверка установки b24phpsdk
```bash
cd APP-B24
composer show bitrix24/b24phpsdk
# Должна быть выведена информация о пакете
```

### 3. Проверка автозагрузки
```bash
php APP-B24/test-autoload.php
# Должны быть выведены сообщения об успешной загрузке
```

### 4. Проверка структуры файлов
```bash
ls -la APP-B24/vendor/autoload.php
# Файл должен существовать
```

---

## Риски и митигация

### Риск 1: Конфликт версий PHP
**Митигация:** Проверить версию PHP перед установкой, обновить при необходимости

### Риск 2: Проблемы с автозагрузкой
**Митигация:** Использовать тестовый скрипт для проверки, проверить пути к файлам

### Риск 3: Конфликты зависимостей
**Митигация:** Проверить `composer.lock`, разрешить конфликты при необходимости

---

## История правок

- **2025-12-20 19:48 (UTC+3, Брест):** Создана задача на установку b24phpsdk

---

**Связанные документы:**
- [TASK-000-crest-to-b24phpsdk-overview.md](TASK-000-crest-to-b24phpsdk-overview.md) — обзор миграции
- [DOCS/REFACTOR/crest-to-b24phpsdk-migration.md](../../crest-to-b24phpsdk-migration.md) — детальный план

---

**Версия документа:** 1.0  
**Последнее обновление:** 2025-12-20 19:48 (UTC+3, Брест)

