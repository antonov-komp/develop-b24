# TASK-006: Тестирование миграции

**Дата создания:** 2025-12-20 19:48 (UTC+3, Брест)  
**Статус:** Новая  
**Приоритет:** Критический  
**Исполнитель:** Bitrix24 Программист (Vanilla JS)

---

## Описание

Комплексное тестирование миграции с CRest на b24phpsdk. Проверка всех функций приложения, сравнение производительности, проверка обработки ошибок.

---

## Контекст

**Часть задачи:** TASK-000 (Миграция CRest → b24phpsdk)  
**Зависит от:** TASK-005 (Обновление bootstrap)  
**Зависимости от этой задачи:** TASK-007 (Удаление CRest)

**Цель:** Убедиться, что миграция выполнена успешно и все функции работают корректно.

---

## Модули и компоненты

**Тестируемые компоненты:**
- Bitrix24SdkClient
- Bitrix24ApiService
- Все контроллеры
- Все сервисы
- Процесс установки

**Тестовые файлы:**
- `APP-B24/test-sdk-client.php` (если создан)
- `APP-B24/test-api-service.php` (если создан)
- `APP-B24/test-install.php` (если создан)

---

## Зависимости

**От каких задач зависит:**
- TASK-005 (Обновление bootstrap) — все должно быть обновлено

**Какие задачи зависят от этой:**
- TASK-007 (Удаление CRest) — только после успешного тестирования

---

## Ступенчатые подзадачи

### 1. Функциональное тестирование API

1. **Тестирование Bitrix24SdkClient:**
   - Инициализация с токеном установщика
   - Инициализация с токеном пользователя
   - Инициализация с вебхуком
   - Простые API вызовы
   - Batch-запросы
   - Обработка ошибок

2. **Тестирование Bitrix24ApiService:**
   - Метод `call()`
   - Метод `getCurrentUser()`
   - Метод `getUser()`
   - Метод `getAllDepartments()`
   - Метод `getAllUsers()`
   - Обработка ошибок

3. **Сравнение с предыдущей версией:**
   - Формат ответов
   - Обработка ошибок
   - Логирование

### 2. Интеграционное тестирование

1. **Тестирование главной страницы:**
   - Открытие index.php
   - Отображение данных пользователя
   - Работа кнопок для администраторов
   - Обработка ошибок доступа

2. **Тестирование управления правами:**
   - Открытие access-control.php
   - Отображение списка отделов
   - Отображение списка пользователей
   - Добавление отдела
   - Добавление пользователя
   - Удаление отдела/пользователя
   - Переключение проверки прав

3. **Тестирование анализа токена:**
   - Открытие token-analysis.php
   - Анализ токена
   - Проверка прав доступа
   - Отображение результата

4. **Тестирование установки:**
   - Установка через ONAPPINSTALL
   - Установка через PLACEMENT
   - Сохранение настроек

### 3. Тестирование производительности

1. **Сравнение времени выполнения:**
   - Замер времени API вызовов
   - Сравнение с предыдущей версией
   - Проверка на деградацию

2. **Проверка использования памяти:**
   - Замер использования памяти
   - Сравнение с предыдущей версией

3. **Проверка логирования:**
   - Проверка записей в логах
   - Проверка формата логов
   - Проверка sanitizeParams

### 4. Тестирование обработки ошибок

1. **Тестирование различных ошибок:**
   - Невалидный токен
   - Несуществующий метод API
   - Ошибки сети
   - Ошибки авторизации

2. **Проверка сообщений об ошибках:**
   - Понятность сообщений
   - Корректность логирования
   - Обработка в UI

### 5. Тестирование в реальной среде

1. **Тестирование в Bitrix24:**
   - Установка приложения
   - Работа всех страниц
   - Проверка всех функций

2. **Тестирование на разных браузерах:**
   - Chrome
   - Firefox
   - Safari
   - Edge

3. **Тестирование на разных устройствах:**
   - Десктоп
   - Планшет
   - Мобильный

---

## Технические требования

- **Покрытие тестами:** Все основные функции должны быть протестированы
- **Производительность:** Не должно быть деградации
- **Совместимость:** Все должно работать как раньше

---

## Критерии приёмки

- [ ] Все API методы работают корректно
- [ ] Все страницы открываются без ошибок
- [ ] Все функции работают как раньше
- [ ] Установка приложения работает
- [ ] Обработка ошибок работает корректно
- [ ] Логирование работает корректно
- [ ] Производительность не ухудшилась
- [ ] Нет ошибок в логах
- [ ] Тестирование в реальной среде пройдено успешно
- [ ] Все тесты пройдены

---

## Тестирование

### 1. Чек-лист функционального тестирования

- [ ] Bitrix24SdkClient инициализируется корректно
- [ ] API вызовы возвращают правильный формат
- [ ] Batch-запросы работают корректно
- [ ] getCurrentUser() возвращает данные пользователя
- [ ] getUser() возвращает данные пользователя
- [ ] getAllDepartments() возвращает список отделов
- [ ] getAllUsers() возвращает список пользователей

### 2. Чек-лист интеграционного тестирования

- [ ] Главная страница отображается корректно
- [ ] Управление правами работает
- [ ] Анализ токена работает
- [ ] Установка приложения работает
- [ ] Все кнопки и формы работают

### 3. Чек-лист тестирования ошибок

- [ ] Невалидный токен обрабатывается корректно
- [ ] Несуществующий метод обрабатывается корректно
- [ ] Ошибки сети обрабатываются корректно
- [ ] Сообщения об ошибках понятны

---

## Риски и митигация

### Риск 1: Пропущенные баги
**Митигация:** Детальное тестирование всех функций, проверка логов

### Риск 2: Проблемы производительности
**Митигация:** Сравнительное тестирование, оптимизация при необходимости

### Риск 3: Проблемы в реальной среде
**Митигация:** Тестирование в реальном Bitrix24, проверка на разных браузерах

---

## История правок

- **2025-12-20 19:48 (UTC+3, Брест):** Создана задача на тестирование миграции

---

**Связанные документы:**
- [TASK-000-crest-to-b24phpsdk-overview.md](TASK-000-crest-to-b24phpsdk-overview.md) — обзор миграции

---

**Версия документа:** 1.0  
**Последнее обновление:** 2025-12-20 19:48 (UTC+3, Брест)



