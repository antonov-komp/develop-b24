# Технологический стек

**Дата создания:** 2025-12-19 11:52 (UTC+3, Брест)  
**Версия:** 1.0  
**Описание:** Описание технологий, используемых в REST приложении Bitrix24

---

## Основная платформа

### Bitrix24
- **Тип:** Облачная версия (REST API)
- **Документация:**
  - https://context7.com/bitrix24/rest/
  - https://apidocs.bitrix24.ru/
- **Методы работы:** REST API через вебхуки

### Backend
- **Язык:** PHP 8.4+
- **Библиотека:** [b24phpsdk](https://github.com/bitrix24/b24phpsdk) — официальный PHP SDK для Bitrix24 REST API
- **Менеджер зависимостей:** Composer
- **Структура:** Модульная архитектура

### Frontend
- **JavaScript:** Vue.js 3.x (Composition API)
- **Сборщик:** Vite
- **Управление состоянием:** Pinia
- **Роутинг:** Vue Router
- **HTTP клиент:** Axios
- **CSS:** CSS3 / SCSS
- **HTML:** HTML5

---

## Интеграции

### Bitrix24 REST API
- **Основной инструмент:** REST API через вебхуки
- **Методы:**
  - `crm.lead.*` — работа с лидами
  - `crm.deal.*` — работа со сделками
  - `crm.contact.*` — работа с контактами
  - `profile` — профиль пользователя
  - И другие методы согласно документации

### Библиотека b24phpsdk
- **Назначение:** Официальный PHP SDK для работы с Bitrix24 REST API
- **Установка:** Через Composer (`composer install`)
- **Использование:**
  ```php
  use App\Clients\Bitrix24SdkClient;
  
  $client = new Bitrix24SdkClient($logger);
  $client->initializeWithInstallerToken();
  $result = $client->call('user.current', []);
  ```
- **Документация:** https://github.com/bitrix24/b24phpsdk

---

## Структура проекта

```
/var/www/backend.antonov-mark.ru/
├── APP-B24/                          # Основное приложение
│   ├── auth-check.php                 # Модуль проверки авторизации Bitrix24
│   ├── access-control.php             # Страница управления правами доступа
│   ├── access-control-functions.php   # Функции для работы с правами доступа
│   ├── access-config.json             # Конфигурация прав доступа
│   ├── config.json                    # Конфигурация доступа к главной странице
│   ├── config-error.php               # Страница ошибки при деактивации интерфейса
│   ├── composer.json                   # Конфигурация Composer
│   ├── vendor/                         # Зависимости (b24phpsdk)
│   ├── failure.php                    # Страница ошибки доступа
│   ├── index.php                      # Главная страница приложения
│   ├── install.php                    # Страница установки приложения
│   ├── settings.json                  # Настройки приложения (токены, домен)
│   ├── token-analysis.php             # Страница анализа токена и прав доступа
│   └── logs/                          # Логи приложения
│       ├── access-check-*.log         # Логи проверки прав доступа
│       ├── access-control-*.log      # Логи управления правами доступа
│       ├── admin-check-*.log          # Логи проверки статуса администратора
│       ├── auth-check-*.log           # Логи проверки авторизации
│       ├── config-check-*.log         # Логи проверки конфигурации
│       ├── token-analysis-*.log      # Логи анализа токена
│       └── user-check-*.log           # Логи проверки пользователя
├── DOCS/                              # Документация
│   ├── ARCHITECTURE/                  # Документация архитектуры
│   ├── TASKS/                         # Задачи проекта
│   │   └── ARCHIVE/                   # Архив выполненных задач
│   └── ...
└── README.md                          # Общее описание проекта
```

---

## Ограничения и особенности

### Безопасность
- Секреты хранятся в `settings.json` (не коммитить в Git)
- Использовать переменные окружения для продакшена
- Валидация всех входящих данных
- Использование официального SDK для работы с API

### Логирование
- Логи сохраняются в `APP-B24/logs/`
- Формат: `YYYY-MM-DD/HH/[timestamp]_[type]_[id]log.json`
- Типы логов: `emptySetting`, и другие

### Производительность
- Кеширование ответов API (если применимо)
- Ограничение частоты запросов к Bitrix24 API
- Асинхронная обработка (если требуется)

---

## Зависимости

### PHP
- Версия: 8.4+
- Расширения:
  - `curl` — для HTTP-запросов
  - `json` — для работы с JSON
  - `openssl` — для SSL-соединений

### Внешние библиотеки
- **b24phpsdk** — официальный PHP SDK для Bitrix24 REST API
  - Установка: `composer require bitrix24/b24phpsdk`
  - Версия: ^1.0

---

## Реализованный функционал

### Система защиты и авторизации
- Защита от прямого доступа через `auth-check.php`
- Проверка авторизации Bitrix24
- Поддержка прямого доступа с валидным токеном установщика

### Система управления правами доступа
- Конфигурационный файл `access-config.json` для управления правами
- Страница управления правами `access-control.php` (только для администраторов)
- Поддержка доступа по отделам и индивидуальным пользователям
- Администраторы всегда имеют доступ

### Конфигурация доступа к главной странице
- Конфигурационный файл `config.json` для управления доступом
- Поддержка временного отключения интерфейса
- Разделение логики для доступа из Bitrix24 и прямого доступа

### Получение данных текущего пользователя
- Использование токена текущего пользователя из параметра `AUTH_ID`
- Отображение данных того пользователя, который открыл приложение (не владельца токена)
- Многоуровневая проверка статуса администратора

### Анализ токена и прав доступа
- Страница `token-analysis.php` для детального анализа токена
- Проверка прав доступа к методам API
- Отображение результата в формате JSON с возможностью копирования

---

## История правок

- **2025-12-19 11:52 (UTC+3, Брест):** Создан документ с описанием технологического стека
- **2025-12-20 18:00 (UTC+3, Брест):** Обновлена структура проекта с учетом реализованного функционала
- **2025-12-21 09:00 (UTC+3, Брест):** Обновлен Frontend стек - добавлен Vue.js 3, Vite, Pinia, Vue Router


