# Архитектура приложения Bitrix24

**Дата создания:** 2025-12-20 18:00 (UTC+3, Брест)  
**Дата обновления:** 2025-12-20 22:00 (UTC+3, Брест)  
**Версия:** 3.0  
**Описание:** Полное описание архитектуры REST-приложения Bitrix24 с учетом всех реализованных функций и рефакторинга

---

## Общая концепция

Приложение представляет собой REST-приложение для Bitrix24, которое:
- Работает внутри экосистемы Bitrix24 через iframe
- Защищено от прямого доступа
- Имеет систему управления правами доступа
- Отображает информацию о текущем пользователе (не владельце токена)
- Предоставляет инструменты для анализа токенов и управления доступом

---

## Структура проекта

```
/var/www/backend.antonov-mark.ru/
├── APP-B24/                          # Основное приложение
│   ├── src/                          # Исходный код приложения
│   │   ├── Services/                  # Сервисы бизнес-логики
│   │   │   ├── LoggerService.php      # Сервис логирования
│   │   │   ├── ConfigService.php      # Сервис работы с конфигурацией
│   │   │   ├── Bitrix24ApiService.php # Сервис работы с Bitrix24 API
│   │   │   ├── UserService.php        # Сервис работы с пользователями
│   │   │   ├── AccessControlService.php # Сервис управления правами доступа
│   │   │   └── AuthService.php        # Сервис авторизации
│   │   ├── Controllers/               # Контроллеры (MVC)
│   │   │   ├── BaseController.php     # Базовый контроллер
│   │   │   ├── IndexController.php    # Контроллер главной страницы
│   │   │   ├── AccessControlController.php # Контроллер управления правами
│   │   │   └── TokenAnalysisController.php  # Контроллер анализа токена
│   │   ├── Clients/                   # Клиенты для внешних API
│   │   │   ├── ApiClientInterface.php # Интерфейс клиента API
│   │   │   └── Bitrix24Client.php     # Клиент Bitrix24 REST API
│   │   ├── Exceptions/                 # Исключения
│   │   │   ├── Bitrix24ApiException.php # Исключение для ошибок API
│   │   │   ├── AccessDeniedException.php # Исключение для ошибок доступа
│   │   │   └── ConfigException.php    # Исключение для ошибок конфигурации
│   │   ├── Helpers/                    # Вспомогательные классы
│   │   │   ├── DomainResolver.php      # Резолвер домена портала
│   │   │   └── AdminChecker.php       # Проверка статуса администратора
│   │   └── bootstrap.php              # Инициализация сервисов
│   ├── templates/                     # HTML-шаблоны
│   │   ├── layout.php                 # Базовый шаблон
│   │   ├── index.php                  # Шаблон главной страницы
│   │   ├── access-control.php         # Шаблон управления правами
│   │   ├── access-denied.php          # Шаблон отказа в доступе
│   │   ├── token-analysis.php         # Шаблон анализа токена
│   │   └── token-analysis-denied.php  # Шаблон отказа в доступе (анализ токена)
│   ├── index.php                      # Точка входа главной страницы
│   ├── access-control.php             # Точка входа управления правами
│   ├── token-analysis.php             # Точка входа анализа токена
│   ├── crest.php                      # Библиотека CRest для работы с Bitrix24 REST API
│   ├── access-config.json             # Конфигурация прав доступа
│   ├── config.json                    # Конфигурация доступа к главной странице
│   ├── settings.json                  # Настройки приложения (токены, домен)
│   └── logs/                          # Логи приложения
│       ├── access-check-*.log         # Логи проверки прав доступа
│       ├── access-control-*.log      # Логи управления правами доступа
│       ├── auth-check-*.log           # Логи проверки авторизации
│       ├── config-check-*.log         # Логи проверки конфигурации
│       └── token-analysis-*.log       # Логи анализа токена
├── DOCS/                              # Документация
│   ├── ARCHITECTURE/                  # Документация архитектуры
│   ├── TASKS/                         # Задачи проекта
│   │   └── ARCHIVE/                   # Архив выполненных задач
│   └── ...
└── README.md                          # Общее описание проекта
```

---

## Система защиты и авторизации

### 1. Модуль проверки авторизации (`auth-check.php`)

**Назначение:** Защита файлов приложения от прямого доступа и проверка авторизации Bitrix24.

**Основные функции:**

#### `checkBitrix24Auth()`
Проверяет, что запрос приходит из Bitrix24 с активной авторизацией.

**Логика проверки:**
1. **Для `install.php`:**
   - Разрешает доступ только при наличии параметров установки от Bitrix24
   - Параметры: `event=ONAPPINSTALL`, `PLACEMENT=DEFAULT`, или `AUTH_ID` + `DOMAIN`

2. **Для `index.php` и других файлов:**
   - Проверяет наличие параметров Bitrix24 (`DOMAIN`, `AUTH_ID`, `APP_SID`)
   - Проверяет Referer header на наличие домена Bitrix24
   - Проверяет User-Agent на наличие информации о Bitrix24
   - Проверяет валидность токена через API-запрос к Bitrix24
   - Разрешает прямой доступ с валидным токеном установщика (из `settings.json`)

3. **Проверка прав доступа:**
   - Если авторизация прошла успешно, проверяет права доступа через `checkUserAccess()`
   - Администраторы всегда имеют доступ
   - Обычные пользователи проверяются по отделам и индивидуальным правам

**Логирование:**
- Все проверки логируются в `logs/auth-check-YYYY-MM-DD.log`
- Логируются параметры запроса, результат проверки, тип доступа

#### `redirectToFailure()`
Выполняет редирект на страницу ошибки `failure.php` при запрете доступа.

---

### 2. Система управления правами доступа

#### Конфигурационный файл (`access-config.json`)

**Структура:**
```json
{
  "access_control": {
    "enabled": true,
    "departments": [
      {
        "id": 1,
        "name": "Отдел продаж",
        "added_at": "2025-12-20 16:55:10",
        "added_by": {
          "id": "1",
          "name": "Марк Антонов"
        }
      }
    ],
    "users": [
      {
        "id": 13,
        "name": "Алеша Читающий",
        "email": "user_work@antonov-mark.ru",
        "added_at": "2025-12-20 16:55:10",
        "added_by": {
          "id": "1",
          "name": "Марк Антонов"
        }
      }
    ],
    "last_updated": "2025-12-20 16:55:10",
    "updated_by": {
      "id": "1",
      "name": "Марк Антонов"
    }
  }
}
```

**Принцип работы:**
- Если `enabled: false` — проверка прав доступа отключена (все авторизованные пользователи имеют доступ)
- Если `enabled: true` — проверка прав доступа включена:
  - **Администраторы** всегда имеют доступ (независимо от настроек)
  - **Обычные пользователи** имеют доступ только если:
    - Их отдел в списке `departments`
    - ИЛИ их ID в списке `users`
  - Если списки `departments` и `users` пустые — все не-администраторы получают страницу ошибки

#### Страница управления правами (`access-control.php`)

**Доступ:** Только для администраторов Bitrix24

**Функциональность:**
1. **Отображение текущих настроек:**
   - Список отделов с доступом (ID, название, дата добавления, кто добавил)
   - Список пользователей с доступом (ID, ФИО, email, дата добавления, кто добавил)
   - Переключатель "Включить/выключить проверку прав доступа"

2. **Добавление отдела:**
   - Выпадающий список всех отделов портала (получение через `department.get`)
   - Сохранение: ID отдела, название, дата, кто добавил

3. **Добавление пользователя:**
   - Поиск пользователей (по имени, email)
   - Выпадающий список найденных пользователей
   - Сохранение: ID пользователя, ФИО, email, дата, кто добавил

4. **Удаление отдела/пользователя:**
   - Кнопка "Удалить" рядом с каждым отделом/пользователем
   - Подтверждение удаления

5. **Сохранение изменений:**
   - Все изменения сохраняются в `access-config.json`
   - Логирование всех операций в `logs/access-control-YYYY-MM-DD.log`

#### Функции работы с правами доступа (`access-control-functions.php`)

**Основные функции:**
- `getAccessConfig()` — чтение `access-config.json`
- `saveAccessConfig($config)` — сохранение `access-config.json`
- `checkUserAccess($userId, $userDepartments, $authId, $domain)` — проверка прав доступа пользователя
- `addDepartmentToAccess($departmentId, $departmentName, $addedBy)` — добавление отдела
- `removeDepartmentFromAccess($departmentId)` — удаление отдела
- `addUserToAccess($userId, $userName, $userEmail, $addedBy)` — добавление пользователя
- `removeUserFromAccess($userId)` — удаление пользователя
- `toggleAccessControl($enabled, $updatedBy)` — включение/выключение проверки прав доступа
- `getAllDepartments($authId, $domain)` — получение списка всех отделов
- `getAllUsers($authId, $domain, $search = null)` — получение списка всех пользователей

---

### 3. Конфигурация доступа к главной странице (`config.json`)

**Структура:**
```json
{
  "index_page": {
    "enabled": true,
    "message": "Интерфейс приложения временно недоступен. Пожалуйста, попробуйте позже.",
    "last_updated": "2025-12-19 14:07:00",
    "updated_by": "system"
  }
}
```

**Принцип работы:**
- Если запрос идет из Bitrix24 (через iframe) — **всегда разрешаем доступ**, проверка конфига не выполняется
- Если запрос прямой (прямой URL) — проверяем конфиг:
  - Если `enabled: true` — доступ разрешён
  - Если `enabled: false` — показывается страница ошибки `config-error.php` с сообщением из конфига

**Функция проверки:** `checkIndexPageConfig()` в `index.php`

---

## Главная страница приложения (`index.php`)

### Последовательность проверок

1. **Проверка авторизации Bitrix24:**
   - Вызов `checkBitrix24Auth()` из `auth-check.php`
   - Если не прошла → редирект на `failure.php`

2. **Проверка конфигурации доступа:**
   - Проверка, идет ли запрос из Bitrix24 (через `isRequestFromBitrix24()`)
   - Если прямой доступ — проверка `config.json`:
     - Если `enabled: false` → показывается `config-error.php`
     - Если `enabled: true` → продолжение

3. **Проверка прав доступа:**
   - Если `access-config.json` содержит `enabled: true`:
     - Проверка статуса администратора
     - Если не администратор — проверка прав доступа через `checkUserAccess()`
     - Если нет прав → редирект на `failure.php`

4. **Отображение интерфейса:**
   - Получение данных текущего пользователя через `getCurrentUserData()`
   - Отображение приветствия с информацией о пользователе:
     - ФИО пользователя
     - Фото пользователя (если есть)
     - Статус: "Администратор на портале" или "Пользователь"
     - ID пользователя
     - Email (если указан)
     - Отдел: название и ID в одну строку (или только ID, если нет прав на название)
     - Часовой пояс
     - Домен портала
     - Индикатор используемого токена (текущего пользователя или установщика)

### Получение данных текущего пользователя

**Проблема:** В REST-приложениях Bitrix24 токен в `settings.json` принадлежит установщику приложения, поэтому все запросы через `CRest::call()` выполняются от его имени.

**Решение:** Использование токена текущего пользователя из параметра `AUTH_ID`, который Bitrix24 передает при открытии приложения.

**Функция:** `getCurrentUserData($authId, $domain)`

**Логика:**
1. Приоритет 1: Токен текущего пользователя из `$_REQUEST['AUTH_ID']`
2. Приоритет 2: Дополнительный запрос через `user.get` (если поле `ADMIN` отсутствует)
3. Fallback: Токен установщика через `CRest::call('user.current')`

**Методы API:**
- `user.current` — получение данных текущего пользователя
  - Документация: https://context7.com/bitrix24/rest/user.current
- `user.get` — получение данных пользователя по ID (для получения поля `ADMIN`)
  - Документация: https://context7.com/bitrix24/rest/user.get
- `user.admin` — проверка статуса администратора
  - Документация: https://context7.com/bitrix24/rest/user.admin
- `department.get` — получение названия отдела (если есть права)
  - Документация: https://context7.com/bitrix24/rest/department.get

---

## Страница анализа токена (`token-analysis.php`)

**Доступ:** Только для администраторов Bitrix24

**Назначение:** Детальный анализ токена авторизации, его владельца и прав доступа.

**Функциональность:**

1. **Анализ токена:**
   - Наличие токена в запросе
   - Длина токена
   - Preview токена (первые и последние символы, без полного раскрытия)
   - Тип токена (текущего пользователя или установщика)

2. **Данные владельца токена:**
   - ID пользователя
   - ФИО пользователя
   - Email
   - Фото пользователя (URL)
   - Часовой пояс
   - Отдел пользователя (ID и название, если доступно)

3. **Права доступа токена:**
   - Проверка статуса администратора (через поле `ADMIN` или метод `user.admin`)
   - Проверка доступности методов API:
     - `crm.lead.list` — проверка прав на чтение лидов
     - `crm.deal.list` — проверка прав на чтение сделок
     - `crm.contact.list` — проверка прав на чтение контактов
     - `department.get` — проверка прав на чтение отделов
     - `user.get` — проверка прав на чтение пользователей

4. **Отображение результата:**
   - JSON-формат с отступами (pretty print)
   - Кнопка "Копировать JSON" для копирования в буфер обмена
   - Информация о портале (домен, источник домена)

**Логирование:**
- Все операции логируются в `logs/token-analysis-YYYY-MM-DD.log`
- Попытки доступа не-администраторов логируются в `logs/token-analysis-access-denied-YYYY-MM-DD.log`

---

## Страницы ошибок

### 1. `failure.php`
**Назначение:** Страница ошибки доступа при запрете доступа к приложению.

**Отображается при:**
- Прямом доступе без авторизации Bitrix24
- Отсутствии прав доступа (пользователь не в списке отделов/пользователей)

### 2. `config-error.php`
**Назначение:** Страница ошибки при деактивации интерфейса через `config.json`.

**Отображается при:**
- Прямом доступе к `index.php` при `config.json` с `enabled: false`
- Содержит сообщение из конфига и дату последнего обновления

---

## Логирование

### Типы логов

1. **`auth-check-YYYY-MM-DD.log`** — проверка авторизации Bitrix24
   - Параметры запроса
   - Результат проверки
   - Тип доступа (bitrix24_iframe, direct_access_with_installer_token)

2. **`access-check-YYYY-MM-DD.log`** — проверка прав доступа
   - ID пользователя
   - Отделы пользователя
   - Результат проверки (доступ разрешён/запрещён)
   - Причина (администратор, отдел в списке, пользователь в списке, нет прав)

3. **`access-control-YYYY-MM-DD.log`** — управление правами доступа
   - Время операции
   - Тип операции (добавление отдела, удаление пользователя, включение/выключение проверки)
   - Данные операции (ID отдела/пользователя, название/ФИО)
   - Кто выполнил операцию (ID и ФИО администратора)
   - Результат операции (успех/ошибка)

4. **`access-control-debug-YYYY-MM-DD.log`** — отладочные логи управления правами
   - Детальная информация о каждом этапе выполнения операций
   - Ошибки с полным контекстом

5. **`admin-check-YYYY-MM-DD.log`** — проверка статуса администратора
   - Значение поля `ADMIN`
   - Тип данных
   - Результат проверки
   - Все поля пользователя

6. **`config-check-YYYY-MM-DD.log`** — проверка конфигурации доступа
   - Результат проверки (`enabled: true/false`)
   - Сообщение из конфига
   - Ошибки чтения/парсинга конфига

7. **`token-analysis-YYYY-MM-DD.log`** — анализ токена
   - Время анализа
   - Наличие токена
   - Результаты проверки прав доступа
   - Ошибки при проверке методов API

8. **`user-check-YYYY-MM-DD.log`** — проверка пользователя
   - Наличие `AUTH_ID`
   - Длина токена
   - Список параметров запроса

9. **`department-check-YYYY-MM-DD.log`** — проверка отделов
   - ID отдела
   - Название отдела (если получено)
   - Ошибки при получении данных отдела

---

## API-методы Bitrix24, используемые в приложении

### Пользователи
- **`user.current`** — получение данных текущего пользователя
  - Документация: https://context7.com/bitrix24/rest/user.current
- **`user.get`** — получение данных пользователя по ID
  - Документация: https://context7.com/bitrix24/rest/user.get
- **`user.admin`** — проверка, является ли пользователь администратором
  - Документация: https://context7.com/bitrix24/rest/user.admin

### Отделы
- **`department.get`** — получение данных отдела по ID или списка всех отделов
  - Документация: https://context7.com/bitrix24/rest/department.get

### CRM (для проверки прав доступа)
- **`crm.lead.list`** — проверка прав на чтение лидов
  - Документация: https://context7.com/bitrix24/rest/crm.lead.list
- **`crm.deal.list`** — проверка прав на чтение сделок
  - Документация: https://context7.com/bitrix24/rest/crm.deal.list
- **`crm.contact.list`** — проверка прав на чтение контактов
  - Документация: https://context7.com/bitrix24/rest/crm.contact.list

---

## Безопасность

### Защита от прямого доступа
- Все файлы приложения защищены через `auth-check.php`
- Прямой доступ блокируется (редирект на `failure.php`)
- Доступ из Bitrix24 разрешён через iframe

### Защита конфигурационных файлов
- `access-config.json` и `config.json` защищены от прямого доступа через `.htaccess`
- Валидация всех входящих данных
- Обработка ошибок с fallback-механизмами

### Логирование
- Все операции логируются для аудита
- Логи не содержат полных токенов (только preview)
- Детальное логирование для диагностики

---

## Производительность

### Оптимизация запросов
- Использование токена текущего пользователя для получения данных (не установщика)
- Кеширование результатов (если применимо)
- Минимальные запросы к API (только необходимые данные)

### Обработка ошибок
- Fallback-механизмы при ошибках чтения конфигов
- Безопасный режим по умолчанию (доступ разрешён при ошибках)
- Детальное логирование для диагностики

---

## Архитектура после рефакторинга (версия 3.0)

### Принципы архитектуры

Приложение использует **модульную архитектуру** с разделением на слои:

1. **Слой сервисов (Services)** — бизнес-логика приложения
2. **Слой контроллеров (Controllers)** — обработка HTTP-запросов и координация сервисов
3. **Слой представления (Templates)** — HTML-шаблоны для отображения
4. **Слой клиентов (Clients)** — работа с внешними API
5. **Слой исключений (Exceptions)** — обработка ошибок

### Сервисный слой

**Назначение:** Инкапсуляция бизнес-логики приложения.

#### LoggerService
- Унифицированное логирование во всём приложении
- Разные типы логов (info, error, access-check, config-check и т.д.)
- Автоматическое создание директорий для логов

#### ConfigService
- Работа с конфигурационными файлами (JSON)
- Валидация конфигурации
- Безопасное чтение/запись конфигов

#### Bitrix24ApiService
- Единый интерфейс для работы с Bitrix24 REST API
- Поддержка токена текущего пользователя и токена установщика
- Обработка ошибок API

#### UserService
- Работа с данными пользователей
- Проверка статуса администратора
- Получение отделов пользователя

#### AccessControlService
- Управление правами доступа
- Работа с отделами и пользователями
- Проверка доступа пользователя

#### AuthService
- Проверка авторизации Bitrix24
- Валидация токенов
- Проверка источника запроса

### Слой контроллеров (MVC)

**Назначение:** Обработка HTTP-запросов и координация работы сервисов.

#### BaseController
- Базовый класс для всех контроллеров
- Методы: `render()`, `redirect()`, `json()`, `getRequestParam()`
- Работа с шаблонами

#### IndexController
- Обработка главной страницы
- Получение данных пользователя
- Отображение приветствия

#### AccessControlController
- Управление правами доступа
- Обработка POST-запросов (добавление/удаление отделов и пользователей)
- Проверка прав администратора

#### TokenAnalysisController
- Анализ токена авторизации
- Проверка прав доступа к методам API
- Формирование JSON-ответа

### Слой клиентов

**Назначение:** Работа с внешними API.

#### Bitrix24Client
- Обертка над библиотекой CRest
- Унифицированная обработка ошибок
- Логирование всех API-запросов
- Очистка секретных данных из логов
- Маппинг ошибок API на исключения

#### ApiClientInterface
- Интерфейс для клиентов API
- Позволяет заменять реализацию клиента

### Слой исключений

**Назначение:** Унифицированная обработка ошибок.

#### Bitrix24ApiException
- Исключение для ошибок Bitrix24 API
- Содержит код ошибки API и описание

#### AccessDeniedException
- Исключение для ошибок доступа

#### ConfigException
- Исключение для ошибок конфигурации

### Вспомогательные классы (Helpers)

#### DomainResolver
- Определение домена портала Bitrix24
- Поддержка разных источников домена

#### AdminChecker
- Проверка статуса администратора
- Поддержка разных способов проверки (поле ADMIN, IS_ADMIN, метод user.admin)

### Инициализация (bootstrap.php)

**Назначение:** Централизованная инициализация всех сервисов и зависимостей.

**Порядок инициализации:**
1. Исключения
2. Клиенты
3. Сервисы (с зависимостями)
4. Хелперы

**Dependency Injection:** Все зависимости передаются через конструкторы.

### Паттерны проектирования

1. **Service Layer** — бизнес-логика в сервисах
2. **MVC (Model-View-Controller)** — разделение логики и представления
3. **Dependency Injection** — зависимости через конструкторы
4. **Exception Handling** — унифицированная обработка ошибок
5. **Interface Segregation** — интерфейсы для клиентов API

### Преимущества новой архитектуры

1. **Модульность** — каждый компонент имеет четкую ответственность
2. **Тестируемость** — сервисы легко тестировать изолированно
3. **Поддерживаемость** — код легче понимать и изменять
4. **Расширяемость** — легко добавлять новые сервисы и контроллеры
5. **Переиспользуемость** — сервисы можно использовать в разных местах

---

## Архитектура Frontend (Vue.js 3.0)

### Общая концепция

Frontend приложения построен на Vue.js 3 с использованием Composition API, что обеспечивает:
- Компонентный подход к разработке
- Реактивность данных
- Клиентский роутинг без перезагрузки страницы
- Централизованное управление состоянием

### Структура Frontend

```
frontend/
├── src/
│   ├── components/         # Vue.js компоненты
│   │   ├── IndexPage.vue   # Главная страница
│   │   ├── AccessControlPage.vue # Управление правами
│   │   ├── TokenAnalysisPage.vue # Анализ токена
│   │   └── common/         # Общие компоненты
│   │       ├── UserCard.vue
│   │       └── DepartmentList.vue
│   ├── services/           # API сервисы
│   │   ├── api.js          # Базовый API клиент (Axios)
│   │   └── bitrix24Api.js  # Bitrix24 API методы
│   ├── stores/             # Pinia stores
│   │   ├── userStore.js    # Состояние пользователя
│   │   └── accessControlStore.js # Состояние прав доступа
│   ├── router/             # Vue Router
│   │   └── index.js        # Конфигурация роутера
│   ├── utils/              # Утилиты
│   │   └── bitrix24.js     # Интеграция с Bitrix24 BX.* API
│   ├── App.vue             # Корневой компонент
│   └── main.js             # Точка входа
├── package.json            # Зависимости npm
└── vite.config.js          # Конфигурация Vite
```

### Компонентная архитектура

#### Компоненты страниц
- **IndexPage.vue** - главная страница приложения
  - Отображает информацию о текущем пользователе
  - Использует `userStore` для получения данных
  - Интегрирован с Bitrix24 BX.* API

- **AccessControlPage.vue** - управление правами доступа
  - Требует прав администратора
  - Использует `accessControlStore` для управления правами
  - Позволяет добавлять/удалять отделы и пользователей

- **TokenAnalysisPage.vue** - анализ токена
  - Требует прав администратора
  - Отображает детальную информацию о токене и правах доступа

#### Общие компоненты
- **UserCard.vue** - карточка пользователя
- **DepartmentList.vue** - список отделов

### Управление состоянием (Pinia)

#### userStore
- Хранит данные текущего пользователя
- Управляет состоянием загрузки и ошибок
- Методы: `fetchCurrentUser()`, `setAuthParams()`, `clearUser()`

#### accessControlStore
- Хранит конфигурацию прав доступа
- Управляет отделами и пользователями
- Методы: `fetchConfig()`, `addDepartment()`, `removeDepartment()`, `addUser()`, `removeUser()`

### API интеграция

#### Базовый API клиент (api.js)
- Использует Axios для HTTP запросов
- Автоматически добавляет параметры авторизации (AUTH_ID, DOMAIN)
- Обрабатывает ошибки и показывает уведомления через Bitrix24 UI

#### Bitrix24 API сервисы (bitrix24Api.js)
- `userApi` - методы для работы с пользователями
- `accessControlApi` - методы для управления правами
- `tokenAnalysisApi` - методы для анализа токена

### Роутинг (Vue Router)

#### Маршруты
- `/` - главная страница (IndexPage)
- `/access-control` - управление правами (AccessControlPage)
- `/token-analysis` - анализ токена (TokenAnalysisPage)

#### Навигационные хуки
- Проверка авторизации перед доступом к маршрутам
- Проверка прав администратора для защищенных маршрутов

### Интеграция с Bitrix24

#### BX.* API
- Использование `BX.UI.Notification` для уведомлений
- Использование `BX.ajax` для дополнительных запросов (опционально)
- Проверка доступности BX.* API перед использованием

#### Утилиты (bitrix24.js)
- `showNotification()` - показ уведомлений через Bitrix24 UI
- `showPopup()` - показ попапов через Bitrix24 UI
- `ajax()` - выполнение AJAX запросов через BX.ajax или fetch

### Сборка и деплой

#### Development
- Vite dev server на порту 5173
- Hot Module Replacement (HMR)
- Proxy для API запросов

#### Production
- Сборка через `npm run build`
- Минификация и оптимизация кода
- Файлы сохраняются в `public/dist/`
- Интеграция с PHP через `index.php`

---

## История правок

- **2025-12-20 18:00 (UTC+3, Брест):** Создан документ с полным описанием архитектуры приложения
- **2025-12-20 18:00 (UTC+3, Брест):** Описаны все реализованные функции из задач TASK-001 - TASK-005
- **2025-12-20 22:00 (UTC+3, Брест):** Обновлена структура проекта и добавлено описание архитектуры после рефакторинга (версия 3.0)
- **2025-12-21 09:00 (UTC+3, Брест):** Добавлен раздел о Frontend архитектуре (Vue.js 3.0)


